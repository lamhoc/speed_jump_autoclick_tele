local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local LocalPlayer = Players.LocalPlayer

local savedPositions = {}
local autoClickEnabled = false
local antiAfkEnabled = false
local loopTeleportEnabled = false
local autoAcceptTradeEnabled = false 
local loopTeleportDelay = 3

-- GUI Chính
local screenGui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
screenGui.Name = "LHTapMod_Premium"
screenGui.ResetOnSpawn = false

-- Nút Toggle (Mở/Đóng Menu)
local toggleButton = Instance.new("ImageButton", screenGui)
toggleButton.Size = UDim2.new(0, 50, 0, 50)
toggleButton.Position = UDim2.new(1, -70, 0.5, -25)
toggleButton.BackgroundColor3 = Color3.fromRGB(40, 45, 60)
toggleButton.Image = "rbxassetid://6031091002" -- Bạn có thể thay ID icon khác
toggleButton.ClipsDescendants = true
Instance.new("UICorner", toggleButton).CornerRadius = UDim.new(0, 10)
local strokeToggle = Instance.new("UIStroke", toggleButton)
strokeToggle.Color = Color3.fromRGB(80, 120, 255)
strokeToggle.Thickness = 2

-- Main Frame (Menu Chính)
local frame = Instance.new("Frame", screenGui)
frame.Size = UDim2.new(0, 350, 0, 550)
frame.Position = UDim2.new(0.5, -175, 0.5, -275)
frame.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
frame.BorderSizePixel = 0
frame.Visible = false
frame.Active = true
frame.Draggable = true
Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 15)

-- Background Image (Hình nền theo yêu cầu của bạn)
local bgImage = Instance.new("ImageLabel", frame)
bgImage.Size = UDim2.new(1, 0, 1, 0)
bgImage.Image = "rbxassetid://12971221770" -- Đã thay bằng ID ảnh phong cảnh tối màu tương tự hình bạn gửi
bgImage.ScaleType = Enum.ScaleType.Crop
bgImage.ImageColor3 = Color3.fromRGB(150, 150, 150) -- Làm tối ảnh một chút để nổi chữ
bgImage.ZIndex = 0
Instance.new("UICorner", bgImage).CornerRadius = UDim.new(0, 15)

-- Lớp phủ tối (Overlay) để dễ nhìn UI
local overlay = Instance.new("Frame", frame)
overlay.Size = UDim2.new(1, 0, 1, 0)
overlay.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
overlay.BackgroundTransparency = 0.4
overlay.ZIndex = 1
Instance.new("UICorner", overlay).CornerRadius = UDim.new(0, 15)

-- Tiêu đề
local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1, 0, 0, 50)
title.BackgroundTransparency = 1
title.Text = "LH_TAPMOD PREMIUM"
title.Font = Enum.Font.GothamBold
title.TextColor3 = Color3.new(1, 1, 1)
title.TextSize = 22
title.ZIndex = 2

-- Scrolling Frame (Để chứa các tính năng)
local scroll = Instance.new("ScrollingFrame", frame)
scroll.Size = UDim2.new(1, -20, 1, -70)
scroll.Position = UDim2.new(0, 10, 0, 60)
scroll.BackgroundTransparency = 1
scroll.ScrollBarThickness = 4
scroll.ZIndex = 2
scroll.CanvasSize = UDim2.new(0, 0, 0, 700)

local layout = Instance.new("UIListLayout", scroll)
layout.Padding = UDim.new(0, 10)
layout.HorizontalAlignment = Enum.HorizontalAlignment.Center

-- FPS Counter (Góc màn hình)
local fpsLabel = Instance.new("TextLabel", screenGui)
fpsLabel.Size = UDim2.new(0, 100, 0, 30)
fpsLabel.Position = UDim2.new(0, 15, 0, 15)
fpsLabel.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
fpsLabel.TextColor3 = Color3.fromRGB(0, 255, 150)
fpsLabel.Font = Enum.Font.Code
fpsLabel.TextSize = 16
fpsLabel.Text = "FPS: 0"
Instance.new("UICorner", fpsLabel).CornerRadius = UDim.new(0, 8)

-- Logic FPS
local lastUpdate = tick()
local frameCount = 0
RunService.RenderStepped:Connect(function()
    frameCount += 1
    if tick() - lastUpdate >= 1 then
        fpsLabel.Text = "FPS: " .. tostring(frameCount)
        frameCount = 0
        lastUpdate = tick()
    end
end)

--- [ UI COMPONENTS ] ---

local function createCheckbox(text, callback)
    local btn = Instance.new("TextButton", scroll)
    btn.Size = UDim2.new(0.9, 0, 0, 40)
    btn.BackgroundColor3 = Color3.fromRGB(60, 65, 80)
    btn.Text = "  ○ " .. text
    btn.Font = Enum.Font.GothamSemibold
    btn.TextColor3 = Color3.new(1, 1, 1)
    btn.TextSize = 14
    btn.TextXAlignment = Enum.TextXAlignment.Left
    btn.ZIndex = 3
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 8)
    
    local enabled = false
    btn.MouseButton1Click:Connect(function()
        enabled = not enabled
        callback(enabled)
        btn.Text = (enabled and "  ● " or "  ○ ") .. text
        btn.BackgroundColor3 = enabled and Color3.fromRGB(80, 120, 255) or Color3.fromRGB(60, 65, 80)
    end)
end

local function createTextBox(labelText, defaultValue, callback)
    local frameRow = Instance.new("Frame", scroll)
    frameRow.Size = UDim2.new(0.9, 0, 0, 40)
    frameRow.BackgroundTransparency = 1
    frameRow.ZIndex = 3

    local label = Instance.new("TextLabel", frameRow)
    label.Size = UDim2.new(0.4, 0, 1, 0)
    label.Text = labelText
    label.TextColor3 = Color3.new(1, 1, 1)
    label.Font = Enum.Font.Gotham
    label.BackgroundTransparency = 1
    label.TextSize = 14

    local tb = Instance.new("TextBox", frameRow)
    tb.Size = UDim2.new(0.6, 0, 0.8, 0)
    tb.Position = UDim2.new(0.4, 0, 0.1, 0)
    tb.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
    tb.Text = tostring(defaultValue)
    tb.TextColor3 = Color3.new(1, 1, 1)
    Instance.new("UICorner", tb).CornerRadius = UDim.new(0, 5)
    
    tb.FocusLost:Connect(function() callback(tonumber(tb.Text)) end)
end

--- [ FEATURES LOGIC ] ---

-- 1. Auto Accept Trade (Fish It) - Spam 1s/lần
createCheckbox("Auto Accept Trade (Fish It)", function(enabled)
    autoAcceptTradeEnabled = enabled
    if enabled then
        task.spawn(function()
            while autoAcceptTradeEnabled do
                pcall(function()
                    local yesButton = LocalPlayer.PlayerGui.Prompt.Blackout.Options.Yes
                    if yesButton and yesButton.Visible then
                        local x = yesButton.AbsolutePosition.X + (yesButton.AbsoluteSize.X / 2)
                        local y = yesButton.AbsolutePosition.Y + (yesButton.AbsoluteSize.Y / 2) + 58
                        VirtualInputManager:SendMouseButtonEvent(x, y, 0, true, game, 1)
                        task.wait(0.05)
                        VirtualInputManager:SendMouseButtonEvent(x, y, 0, false, game, 1)
                    end
                end)
                task.wait(1)
            end
        end)
    end
end)

-- 2. Auto Click
createCheckbox("Auto Click Center", function(enabled)
    autoClickEnabled = enabled
    if enabled then
        task.spawn(function()
            while autoClickEnabled do
                VirtualInputManager:SendMouseButtonEvent(LocalPlayer.PlayerGui.ScreenGui.AbsoluteSize.X/2, LocalPlayer.PlayerGui.ScreenGui.AbsoluteSize.Y/2, 0, true, nil, 0)
                task.wait(0.05)
                VirtualInputManager:SendMouseButtonEvent(LocalPlayer.PlayerGui.ScreenGui.AbsoluteSize.X/2, LocalPlayer.PlayerGui.ScreenGui.AbsoluteSize.Y/2, 0, false, nil, 0)
                task.wait(0.1)
            end
        end)
    end
end)

-- 3. WalkSpeed & JumpPower
createTextBox("WalkSpeed", 16, function(v) LocalPlayer.Character.Humanoid.WalkSpeed = v end)
createTextBox("JumpPower", 50, function(v) LocalPlayer.Character.Humanoid.JumpPower = v end)

-- 4. Anti AFK
createCheckbox("Anti AFK", function(enabled)
    antiAfkEnabled = enabled
    if enabled then
        task.spawn(function()
            while antiAfkEnabled do
                VirtualInputManager:SendMouseMoveEvent(math.random(100, 500), math.random(100, 500), game)
                task.wait(30)
            end
        end)
    end
end)

-- Toggle Menu
toggleButton.MouseButton1Click:Connect(function()
    frame.Visible = not frame.Visible
end)
