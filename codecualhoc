local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local LocalPlayer = Players.LocalPlayer

local TeleportPosition = Vector3.new(0, 0, 0)
local autoClickEnabled = false
local selectedPlayer = nil

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "ModernModMenu"
screenGui.ResetOnSpawn = false
screenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

-- N√∫t toggle menu
local toggleButton = Instance.new("ImageButton")
toggleButton.Size = UDim2.new(0, 40, 0, 40)
toggleButton.Position = UDim2.new(1, -50, 1, -50)
toggleButton.BackgroundTransparency = 1
toggleButton.Image = "rbxassetid://6031091002"
toggleButton.Parent = screenGui

-- Frame menu ch√≠nh
local frame = Instance.new("Frame", screenGui)
frame.Size = UDim2.new(0, 320, 0, 350)
frame.Position = UDim2.new(0, 20, 0, 20)
frame.BackgroundColor3 = Color3.fromRGB(35, 40, 55)
frame.BorderSizePixel = 0
frame.Visible = false
frame.Active = true
frame.Draggable = true
frame.BackgroundTransparency = 0.05
Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 12)

-- Ti√™u ƒë·ªÅ
local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1, 0, 0, 40)
title.BackgroundTransparency = 1
title.Text = "üéÆ Roblox Utility Menu"
title.Font = Enum.Font.GothamBold
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.TextSize = 20

-- Layout
local layout = Instance.new("UIListLayout", frame)
layout.SortOrder = Enum.SortOrder.LayoutOrder
layout.Padding = UDim.new(0, 8)
layout.VerticalAlignment = Enum.VerticalAlignment.Top
layout.HorizontalAlignment = Enum.HorizontalAlignment.Center
title.LayoutOrder = 0

-- FPS Counter
local fpsLabel = Instance.new("TextLabel", screenGui)
fpsLabel.Size = UDim2.new(0, 100, 0, 25)
fpsLabel.Position = UDim2.new(0, 10, 0, 10)
fpsLabel.BackgroundTransparency = 0.4
fpsLabel.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
fpsLabel.TextColor3 = Color3.new(1, 1, 1)
fpsLabel.Font = Enum.Font.Code
fpsLabel.TextSize = 16
fpsLabel.Text = "FPS: 0"
Instance.new("UICorner", fpsLabel).CornerRadius = UDim.new(0, 6)

-- FPS updater
local lastUpdate = tick()
local frameCount = 0
RunService.RenderStepped:Connect(function()
	frameCount += 1
	if tick() - lastUpdate >= 1 then
		fpsLabel.Text = "FPS: " .. tostring(frameCount)
		frameCount = 0
		lastUpdate = tick()
	end
end)

-- Helper functions
local function createContainer(height)
	local container = Instance.new("Frame")
	container.Size = UDim2.new(0.9, 0, 0, height)
	container.BackgroundTransparency = 1
	container.LayoutOrder = layout.AbsoluteContentSize.Y
	container.Name = "Row"
	return container
end

local function createTextBox(labelText, defaultValue, callback)
	local container = createContainer(36)
	local label = Instance.new("TextLabel", container)
	label.Size = UDim2.new(0.4, 0, 1, 0)
	label.Text = labelText
	label.BackgroundTransparency = 1
	label.Font = Enum.Font.Gotham
	label.TextColor3 = Color3.fromRGB(220, 220, 220)
	label.TextSize = 16
	label.TextXAlignment = Enum.TextXAlignment.Left

	local textBox = Instance.new("TextBox", container)
	textBox.Size = UDim2.new(0.6, -8, 1, 0)
	textBox.Position = UDim2.new(0.4, 8, 0, 0)
	textBox.Text = tostring(defaultValue)
	textBox.Font = Enum.Font.GothamSemibold
	textBox.TextSize = 16
	textBox.BackgroundColor3 = Color3.fromRGB(50, 60, 80)
	textBox.TextColor3 = Color3.fromRGB(255, 255, 255)
	Instance.new("UICorner", textBox).CornerRadius = UDim.new(0, 6)

	textBox.FocusLost:Connect(function(enter)
		if enter then callback(tonumber(textBox.Text)) end
	end)

	container.Parent = frame
end

local function createButton(text, callback)
	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(0.9, 0, 0, 36)
	btn.Text = text
	btn.BackgroundColor3 = Color3.fromRGB(70, 130, 180)
	btn.TextColor3 = Color3.fromRGB(255, 255, 255)
	btn.Font = Enum.Font.GothamBold
	btn.TextSize = 16
	Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 6)
	btn.MouseEnter:Connect(function() btn.BackgroundColor3 = Color3.fromRGB(90, 150, 200) end)
	btn.MouseLeave:Connect(function() btn.BackgroundColor3 = Color3.fromRGB(70, 130, 180) end)
	btn.MouseButton1Click:Connect(callback)
	btn.Parent = frame
end

local function createCheckbox(text, callback)
	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(0.9, 0, 0, 36)
	btn.Text = "‚òê " .. text
	btn.BackgroundColor3 = Color3.fromRGB(90, 90, 90)
	btn.TextColor3 = Color3.fromRGB(255, 255, 255)
	btn.Font = Enum.Font.Gotham
	btn.TextSize = 16
	Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 6)

	local enabled = false
	btn.MouseButton1Click:Connect(function()
		enabled = not enabled
		btn.Text = (enabled and "‚òë " or "‚òê ") .. text
		callback(enabled)
	end)

	btn.Parent = frame
end

-- Giao di·ªán ch√≠nh
createTextBox("Speed", 16, function(val)
	local h = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
	if h then h.WalkSpeed = val end
end)

createTextBox("Jump", 50, function(val)
	local h = LocalPlayer.Character and LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
	if h then h.JumpPower = val end
end)

createButton("üìå L∆∞u v·ªã tr√≠", function()
	local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
	if hrp then TeleportPosition = hrp.Position end
end)

createButton("üß≠ Teleport", function()
	local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
	if hrp then hrp.CFrame = CFrame.new(TeleportPosition) end
end)

createCheckbox("‚ö° Auto Click", function(enabled)
	autoClickEnabled = enabled
	if enabled then
		spawn(function()
			while autoClickEnabled do
				VirtualInputManager:SendMouseButtonEvent(0.5, 0.5, 0, true, nil, 0)
				VirtualInputManager:SendMouseButtonEvent(0.5, 0.5, 0, false, nil, 0)
				task.wait(0.1)
			end
		end)
	end
end)

-- Dropdown ch·ªçn ng∆∞·ªùi ch∆°i ƒë·ªÉ teleport ƒë·∫øn
local dropdownButton = Instance.new("TextButton")
dropdownButton.Size = UDim2.new(0.9, 0, 0, 36)
dropdownButton.Text = "Ch·ªçn ng∆∞·ªùi ch∆°i"
dropdownButton.BackgroundColor3 = Color3.fromRGB(70, 130, 180)
dropdownButton.TextColor3 = Color3.fromRGB(255, 255, 255)
dropdownButton.Font = Enum.Font.GothamBold
dropdownButton.TextSize = 16
Instance.new("UICorner", dropdownButton).CornerRadius = UDim.new(0, 6)
dropdownButton.Parent = frame

local dropdownOpen = false

local listFrame = Instance.new("ScrollingFrame")
listFrame.Size = UDim2.new(0.9, 0, 0, 120)
listFrame.Position = UDim2.new(0, 0, 0, 0)
listFrame.BackgroundColor3 = Color3.fromRGB(50, 60, 80)
listFrame.BorderSizePixel = 0
listFrame.Visible = false
listFrame.Parent = frame
Instance.new("UICorner", listFrame).CornerRadius = UDim.new(0, 6)
listFrame.CanvasSize = UDim2.new(0, 0, 0, 0)

local listLayout = Instance.new("UIListLayout", listFrame)
listLayout.SortOrder = Enum.SortOrder.LayoutOrder
listLayout.Padding = UDim.new(0, 4)

-- H√†m c·∫≠p nh·∫≠t danh s√°ch ng∆∞·ªùi ch∆°i
local function updatePlayerList()
    -- Xo√° danh s√°ch c≈©
    for _, child in pairs(listFrame:GetChildren()) do
        if child:IsA("TextButton") then
            child:Destroy()
        end
    end

    for i, player in ipairs(Players:GetPlayers()) do
        local playerBtn = Instance.new("TextButton")
        playerBtn.Size = UDim2.new(1, 0, 0, 30)
        playerBtn.BackgroundColor3 = Color3.fromRGB(80, 90, 110)
        playerBtn.TextColor3 = Color3.new(1, 1, 1)
        playerBtn.Font = Enum.Font.Gotham
        playerBtn.TextSize = 16
        playerBtn.Text = player.Name
        playerBtn.LayoutOrder = i
        playerBtn.Parent = listFrame
        Instance.new("UICorner", playerBtn).CornerRadius = UDim.new(0, 6)

        playerBtn.MouseButton1Click:Connect(function()
            selectedPlayer = player
            dropdownButton.Text = "‚Üí " .. player.Name
            listFrame.Visible = false
            dropdownOpen = false
        end)
    end
    -- C·∫≠p nh·∫≠t CanvasSize d·ª±a v√†o t·ªïng chi·ªÅu cao c√°c ph·∫ßn t·ª≠
    listFrame.CanvasSize = UDim2.new(0, 0, 0, listLayout.AbsoluteContentSize.Y)
end

dropdownButton.MouseButton1Click:Connect(function()
    dropdownOpen = not dropdownOpen
    listFrame.Visible = dropdownOpen
    if dropdownOpen then
        updatePlayerList()
    end
end)

-- N√∫t Teleport ƒë·∫øn ng∆∞·ªùi ch∆°i ƒë∆∞·ª£c ch·ªçn
createButton("üöÄ Teleport ƒë·∫øn ng∆∞·ªùi ch∆°i", function()
    if selectedPlayer and selectedPlayer.Character and selectedPlayer.Character:FindFirstChild("HumanoidRootPart") then
        local hrp = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if hrp then
            hrp.CFrame = selectedPlayer.Character.HumanoidRootPart.CFrame + Vector3.new(0, 3, 0)
        end
    end
end)

-- Toggle menu
toggleButton.MouseButton1Click:Connect(function()
	frame.Visible = not frame.Visible
end)
